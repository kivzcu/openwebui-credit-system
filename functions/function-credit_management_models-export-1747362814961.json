[{"id":"credit_management_models","user_id":"709ec92f-c42b-49d0-8763-cfb32116714d","name":"Credit management Models","type":"action","content":"\"\"\"\ntitle: Credit management Models\nauthor: DDVVY\nversion: 1.0\n\"\"\"\n\nfrom pydantic import BaseModel, Field\nimport httpx\n\n\nclass Action:\n    class Valves(BaseModel):\n        show_status: bool = Field(\n            default=False, description=\"Not used â€“ reserved for future options\"\n        )\n\n    def __init__(self):\n        self.valves = self.Valves()\n\n    async def action(\n        self, body, __user__=None, __event_emitter__=None, __event_call__=None\n    ):\n        model_name = body.get(\"model\", \"\")\n\n        try:\n            async with httpx.AsyncClient() as client:\n                res = await client.get(\n                    \"http://host.docker.internal:8000/api/credits/models\"\n                )\n                res.raise_for_status()\n                models = res.json()\n        except Exception as e:\n            body[\"messages\"][-1][\n                \"content\"\n            ] += f\"\\n\\n Failed to load model pricing: {str(e)}\"\n            return body\n\n        model_data = next((m for m in models if m.get(\"id\") == model_name), None)\n\n        if not model_data:\n            body[\"messages\"][-1][\"content\"] += \"\\n\\n Model not found in pricing list.\"\n            return body\n\n        fixed = model_data.get(\"fixed_price\", 0)\n        variable = model_data.get(\"variable_price\", 0)\n\n        body[\"messages\"][-1][\"content\"] += (\n            f\"\\n\\nðŸ“Š Model **{model_name}** pricing:\\n\"\n            f\"â€¢ Prompt (input): {fixed} credits/token\\n\"\n            f\"â€¢ Completion (output): {variable} credits/token\"\n        )\n\n        return body\n","meta":{"description":"A component of the Credit Management extension for displaying model prices.","manifest":{"title":"Credit management Models","author":"DDVVY","version":"1.0"}},"is_active":true,"is_global":true,"updated_at":1747362151,"created_at":1747360595}]